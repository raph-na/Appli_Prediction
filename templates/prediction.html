<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importations</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<style>

</style>
<body>
       
    <!-- Barre de navigation -->
    <nav class="navbar">
        <div class="logo">Pr√©visions</div>
        <ul class="nav-links">
            <li><a id="monLien" href="/gestion_acceuil" onclick="rediriger_vers_acceuil()">Accueil</a></li>
            <li><a id="monLien" href="/gestion_importation" onclick="rediriger_vers_importation()">Importations</a></li>
            <li><a id="monLien" href="/gestion_prediction" onclick="rediriger_vers_prediction()">Pr√©diction</a></li>
            <li><a href="#">Rapports</a></li>
            <li><a href="#">Clients</a></li>
            <li><a href="#">Param√®tres</a></li>
        </ul>
        
        <div class="search-container">
            <input type="text" placeholder="Rechercher...">
            <button type="submit">Go</button>
        </div>
    </nav>
       
    <nav class="nav-mobile">
        <details class="nav-details">
            <summary class="nav-summary"></summary>
            <ul class="nav-mobile-menu">
                <li class="nav-mobile-item"><a href="/" class="nav-mobile-link">Accueil</a></li>
                <li class="nav-mobile-item"><a href="/" class="nav-mobile-link">Importations</a></li>
                <li class="nav-mobile-item"><a href="#" class="nav-mobile-link">Analyses</a></li>
                <li class="nav-mobile-item"><a href="#" class="nav-mobile-link">Rapports</a></li>
                <li class="nav-mobile-item"><a href="#" class="nav-mobile-link">Clients</a></li>
                <li class="nav-mobile-item"><a href="#" class="nav-mobile-link">Param√®tres</a></li>
            </ul>
        </details>
        <div class="search-container">
            <input type="text" placeholder="Rechercher...">
            <button type="submit">Go</button>
        </div>
    </nav>

    <section class="hero-section">
        <div class="hero-content">
            <h1>Pr√©diction</h1>
        </div>
    </section>
      
    <p class="haut">Il s'agit de l'√©tape qui vous permettra de faire votre pr√©diction. 
        Vous pouvez importer vos donn√©es dans plusieurs formats : CSV, Excel, JSON, etc.
    </p>

    <!-- Section d'importation de la dataset -->

<section id="cont">
    <div class="container">
        <h1>Importer votre fichier</h1>

        <form method="POST" action="/import_prediction" enctype="multipart/form-data" id="uploadForm">
            <input type="file" name="monfichier"  id="fileInput" 
                   accept=".csv,.xlsx,.xls,.json">
            <button type="submit" name="pretrait" value="analyser">Valider</button>
        </form>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="error">
                    {% for message in messages %}
                        <p>{{ message }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        {% if filename %}
        <div class="success">
            <p> Fichier <strong>{{ filename }}</strong> import√© avec succ√®s !</p>
            <p>{{ shape }}</p>
        </div>
        
        {% endif %}
     
    <span id="fileName"></span>
</div>

<!-- Section du choix des features Target et date -->

     {% if fichier_upload %}
     <div>
            <h1 id="choix_target">Choisir la Target pour la Pr√©diction</h1>

    <form method="POST" action="/choix_target" id="choix">
     <div id="choix_target">
      <div class="target">
        <label for="target">S√©lectionner la colonne a pr√©dire (target) et la colonne des Dates :</label><br><br>
        <select name="target" id="date">
            <option value="">S√©lectionner la target (variable cible)</option>
            {% for column in columns %}
                <option value="{{ column }}" {% if column == target_column %}selected{% endif %}>{{ column }}</option>
            {% endfor %}
        </select><br><br>
        <select name="date" id="date">
            <option value="">S√©lectionner la colonne date</option>
            {% for column in columns %}
                <option value="{{ column }}" {% if column == date_column %}selected{% endif %}>{{ column }}</option>
            {% endfor %}
        </select><br><br>
        <select name="modele" id="date">
            <option value="">S√©lectionner le mod√®le</option>
                <option value="hbgr">Hist Boosting Gradient Regressor</option>
                <option value="rf">Random Forest Regressor</option>
        </select><br><br>
      </div>  
 <!-- Section de la logique html et de selection des dates -->
      <div class="datemois" >
            <!-- JOURS -->
        <label>Pr√©dire dans combien de jours :</label>
        <select name="n_days">
            <option value="0">-- Aucun --</option>
            {% for i in range(1, 31) %}
                <option value="{{ i }}">{{ i }} jour(s)</option>
            {% endfor %}
        </select>

        <br><br>

        <!-- MOIS -->
        <label>Pr√©dire dans combien de mois :</label>
        <select name="n_months">
            <option value="0">-- Aucun --</option>
            {% for i in range(1, 13) %}
                <option value="{{ i }}">{{ i }} mois</option>
            {% endfor %}
        </select>

        <br><br>

        <!-- ANN√âES -->
        <label>Pr√©dire dans combien d'ann√©es :</label>
        <select name="n_years">
            <option value="0">-- Aucun --</option>
            {% for i in range(1, 11) %}
                <option value="{{ i }}">{{ i }} an(s)</option>
            {% endfor %}
        </select>
      </div>
    </div>
        <button type="submit" id="predire">Pr√©dire</button>
    </form>



    {% if target_column %}
        <h2>Donn√©es s√©par√©es en Features et Target :</h2>
        <p><strong>Target choisie (Y) :</strong> {{ target_column }}</p>
        <h3>X (Features) :</h3>
        <pre>{{ X | safe }}</pre>
        <h3>Y (Target) :</h3>
        <pre>{{ y | safe }}</pre>
        <h3>X_future (Target) :</h3>
        <pre>{{ xf | safe }}</pre>
    {% endif %}
     {% endif %}
     </div>
</section>

    <div>
    <!-- Section d'exploration des donn√©es -->
    {% if fichier_upload %}
    <section class="content-section">
        <div class="exp">
            <h1>D√©tails des Donn√©es</h1> 
        </div>
        
        <!-- Statistiques g√©n√©rales -->
        <div class="stats-grid">
            <div class="stat-card">
                <h4>Lignes</h4>
                <div class="stat-value">{{ row_count }}</div>
             </div>

              <div class="stat-card">
                 <h4>Colonnes</h4>
                <div class="stat-value">{{ col_count }}</div>
             </div>

            <div class="stat-card">
                <h4>Doublons</h4>
                <div class="stat-value">{{ doublons }}</div>
            </div>
            
            <div class="stat-card">
                <h4>manquants</h4>
                <div class="stat-value">{{ isnull_sum }}</div>
            </div>
            <div class="stat-card">
                <h4>Colonnes num√©riques</h4>
                <div class="stat-value">{{ numeric_cols|length }}</div>
            </div>
                        <div class="stat-card">
                <h4>R2_SCORE</h4>
                <div class="stat-value">{{ R2_SCORE }}</div>
            </div>
            <div class="stat-card">
                <h4>RMSE</h4>
                <div class="stat-value">{{ RMSE }}</div>
            </div>
             <div class="stat-card">
                <h4>MAE</h4>
                <div class="stat-value">{{ MAE }}</div>
            </div>
             <div class="stat-card">
                <h4>feature Date</h4>
                <div class="stat-value">{{ date_column }}</div>
            </div>
             <div class="stat-card">
                <h4>Target</h4>
                <div class="stat-value">{{ target_column }}</div>
            </div>
            </div>
            <div class="stat-card">
                <h4>Pr√©diction</h4>
                <div class="stat-value">{{ y_pred }}</div>
            </div>

        </div>
        
        <!-- Liste des colonnes -->
        <div class="results">
            <h3>Colonnes du dataset ({{ columns|length }})</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                {% for col in columns %}
                <div style="background: #4a6fa5; color: rgb(255, 255, 255); padding: 5px 10px; border-radius: 4px;">
                    {{ col }}
                </div>
                {% endfor %}

            </div>
     {% endif %}


     {% if target_column %}

         <h2 id="hist">Correlation avec la target</h2>
        {% for scat in scatter_urls %}
            <div id="pad">       
                <img src="data:image/png;base64,{{ scat }}" alt="histogramme">
            </div>
        {% endfor %}
                 <h2 id="hist">HISTOGRAMME</h2>
        {% for histo in temporals_predict %}
            <div id="pad">       
                <img src="data:image/png;base64,{{ histo }}" alt="histogramme">
            </div>
        {% endfor %}
                          
     {% endif %}
        </div>
        

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Pr√©vision des ventes. Tous droits r√©serv√©s.</p>
    </footer>

    <script>
    // JavaScript pour afficher le nom du fichier
    document.getElementById('fileInput').addEventListener('change', function(e) {
        var fileName = e.target.files[0] ? e.target.files[0].name : "Aucun fichier s√©lectionn√©";
        document.getElementById('fileName').textContent = "üìÅ Fichier : " + fileName;
        document.getElementById('fileName').style.color = "rgb(255, 255, 255)";
        document.getElementById('fileName').style.fontWeight = "bold";
    });
    
let clickedAction = null;

document.querySelectorAll("button[name='pretrait']").forEach(btn => {
    btn.addEventListener("click", () => {
        clickedAction = btn.value;
    });
});

document.getElementById("uploadForm").addEventListener("submit", function(e) {
    const fileInput = document.getElementById("fichier");

    if (clickedAction === "analyser" && fileInput.files.length === 0) {
        e.preventDefault();
        alert("Veuillez s√©lectionner un fichier avant l'analyse");
    }
});
    
        function rediriger_vers_importation(){
            window.location.href = "/gestion_importation"
        }
       function rediriger_vers_prediction(){
            window.location.href = "/gestion_prediction"
        }
               function rediriger_vers_acceuil(){
            window.location.href = "/gestion_acceuil"
        }
    
   
    </script>
</body>
</html>